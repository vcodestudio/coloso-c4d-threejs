import{S as U,i as q,s as F,k as _,a as Q,q as G,l as x,m as P,h as y,c as Y,r as X,n as z,b as E,E as $,I as L,o as B,w as I}from"../chunks/index.2ecc7cbf.js";import{E as N,f as g,Q as M,C as K,W as Z,P as J,S as O,G as ee,e as te,g as oe,h as ie,i as se,H as ne,V as ae}from"../chunks/three.module.a6fd982f.js";import{G as re}from"../chunks/GLTFLoader.a254f7ff.js";import{E as ce,R as he,U as me}from"../chunks/UnrealBloomPass.f7db90c7.js";const de={type:"change"};class le extends N{constructor(a,d){super(),this.object=a,this.domElement=d,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const e=this,o=1e-6,t=new M,s=new g;this.tmpQuaternion=new M,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new g(0,0,0),this.rotationVector=new g(0,0,0),this.keydown=function(i){if(!i.altKey){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(i){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(i){if(this.dragToLook)this.status++;else{switch(i.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(i){if(!this.dragToLook||this.status>0){const r=this.getContainerDimensions(),l=r.size[0]/2,k=r.size[1]/2;this.moveState.yawLeft=-(i.pageX-r.offset[0]-l)/l,this.moveState.pitchDown=(i.pageY-r.offset[1]-k)/k,this.updateRotationVector()}},this.pointerup=function(i){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(i.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(i){const r=i*e.movementSpeed,l=i*e.rollSpeed;e.object.translateX(e.moveVector.x*r),e.object.translateY(e.moveVector.y*r),e.object.translateZ(e.moveVector.z*r),e.tmpQuaternion.set(e.rotationVector.x*l,e.rotationVector.y*l,e.rotationVector.z*l,1).normalize(),e.object.quaternion.multiply(e.tmpQuaternion),(s.distanceToSquared(e.object.position)>o||8*(1-t.dot(e.object.quaternion))>o)&&(e.dispatchEvent(de),t.copy(e.object.quaternion),s.copy(e.object.position))},this.updateMovementVector=function(){const i=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-i+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",D),this.domElement.removeEventListener("pointerdown",m),this.domElement.removeEventListener("pointermove",n),this.domElement.removeEventListener("pointerup",b),window.removeEventListener("keydown",u),window.removeEventListener("keyup",w)};const n=this.pointermove.bind(this),m=this.pointerdown.bind(this),b=this.pointerup.bind(this),u=this.keydown.bind(this),w=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",D),this.domElement.addEventListener("pointerdown",m),this.domElement.addEventListener("pointermove",n),this.domElement.addEventListener("pointerup",b),window.addEventListener("keydown",u),window.addEventListener("keyup",w),this.updateMovementVector(),this.updateRotationVector()}}function D(p){p.preventDefault()}function pe(p){let a,d,e,o;return{c(){a=_("canvas"),d=Q(),e=_("div"),o=G('Press "W" or "S"'),this.h()},l(t){a=x(t,"CANVAS",{class:!0}),P(a).forEach(y),d=Y(t),e=x(t,"DIV",{class:!0});var s=P(e);o=X(s,'Press "W" or "S"'),s.forEach(y),this.h()},h(){z(a,"class","svelte-6rhmoh"),z(e,"class","text svelte-6rhmoh")},m(t,s){E(t,a,s),p[1](a),E(t,d,s),E(t,e,s),$(e,o)},p:L,i:L,o:L,d(t){t&&y(a),p[1](null),t&&y(d),t&&y(e)}}}let we=400,fe=.7,ue=0,ve=.8;function Se(p,a,d){let e,o,t,s,n,m,b=performance.now(),u=0;new K("hsl(200, 50%, 50%)"),new g(0,0,0);let w,i;B(()=>{r(),k()});function r(){s=new Z({antialias:!0,canvas:e}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),o=new J(45,window.innerWidth/window.innerHeight,.1,3e3),o.position.set(0,0,0),t=new O,t.background=new K(0);const c=new ee;c.position.copy(o.position),c.rotation.copy(o.rotation),t.add(c),c.add(o),window.addEventListener("resize",A);const j=new re,H=document.querySelector("input.baseUrl").value;j.load(`${H}move/model.glb`,function(R){m=R.scene,m.position.set(0,0,0),console.log(m);const v=.1;m.scale.set(v,v,v),t.add(m);const S=R.cameras[0];o.position.set(S.position.x*v,S.position.y*v,S.position.z*v),o.rotation.set(S.rotation.x,S.rotation.y,S.rotation.z),o.position.clone(),n=new le(o,s.domElement),n.movementSpeed=we,n.rollSpeed=0,n.autoForward=!1,n.dragToLook=!0,n.lockPitch=!0,n.lockYaw=!0,n.lockRoll=!0,n.lockX=!0,n.lockY=!0,m.traverse(function(h){if(h.isMesh){const C=h.material;h.material=new te({color:16777215,roughness:.5,metalic:1}),h.castShadow=!0,h.receiveShadow=!0,h.name=="light"&&(console.log(C),h.material=new oe({color:16777215}),h.castShadow=!1,h.receiveShadow=!1,h.material.side=ie)}})});const f=new se(16777215,1);f.position.set(0,0,0),t.add(f),f.castShadow=!0,f.shadow.mapSize.width=2048,f.shadow.mapSize.height=2048,f.shadow.camera.near=.5,f.shadow.camera.far=2e3;const V=new ne(0,16777215,.3);V.position.set(1,0,1),t.add(V),l()}function l(){w=new ce(s),w.addPass(new he(t,o)),i=new me(new ae(window.innerWidth,window.innerHeight),fe,ue,ve),i.renderToScreen=!0,w.addPass(i)}function k(){const c=performance.now();requestAnimationFrame(k),u=(c-b)/1e3,b=c,n.update(u),o.position.z-=30*u,W()}function W(){s.render(t,o),w.render()}function A(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function T(c){I[c?"unshift":"push"](()=>{e=c,d(0,e)})}return[e,T]}class Ee extends U{constructor(a){super(),q(this,a,Se,pe,F,{})}}export{Ee as default};
