import{S as A,i as T,s as W,k as j,l as H,m as q,h as R,n as C,b as F,I as L,o as Q,w as U}from"../chunks/index.2ecc7cbf.js";import{E as G,f as E,Q as x,C as _,W as Y,P as X,S as B,T as $,d as I,G as N,e as Z,g as J,h as O,i as ee,H as te,V as oe}from"../chunks/three.module.2b01c56e.js";import{G as ie}from"../chunks/GLTFLoader.6b96b0db.js";import{E as ne,R as se,U as ae}from"../chunks/UnrealBloomPass.6138d20b.js";const re={type:"change"};class ce extends G{constructor(n,h){super(),this.object=n,this.domElement=h,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const e=this,o=1e-6,s=new x,a=new E;this.tmpQuaternion=new x,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new E(0,0,0),this.rotationVector=new E(0,0,0),this.keydown=function(t){if(!t.altKey){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(t){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(t){if(this.dragToLook)this.status++;else{switch(t.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(t){if(!this.dragToLook||this.status>0){const r=this.getContainerDimensions(),d=r.size[0]/2,k=r.size[1]/2;this.moveState.yawLeft=-(t.pageX-r.offset[0]-d)/d,this.moveState.pitchDown=(t.pageY-r.offset[1]-k)/k,this.updateRotationVector()}},this.pointerup=function(t){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(t.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(t){const r=t*e.movementSpeed,d=t*e.rollSpeed;e.object.translateX(e.moveVector.x*r),e.object.translateY(e.moveVector.y*r),e.object.translateZ(e.moveVector.z*r),e.tmpQuaternion.set(e.rotationVector.x*d,e.rotationVector.y*d,e.rotationVector.z*d,1).normalize(),e.object.quaternion.multiply(e.tmpQuaternion),(a.distanceToSquared(e.object.position)>o||8*(1-s.dot(e.object.quaternion))>o)&&(e.dispatchEvent(re),s.copy(e.object.quaternion),a.copy(e.object.position))},this.updateMovementVector=function(){const t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-t+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",M),this.domElement.removeEventListener("pointerdown",m),this.domElement.removeEventListener("pointermove",i),this.domElement.removeEventListener("pointerup",b),window.removeEventListener("keydown",u),window.removeEventListener("keyup",w)};const i=this.pointermove.bind(this),m=this.pointerdown.bind(this),b=this.pointerup.bind(this),u=this.keydown.bind(this),w=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",M),this.domElement.addEventListener("pointerdown",m),this.domElement.addEventListener("pointermove",i),this.domElement.addEventListener("pointerup",b),window.addEventListener("keydown",u),window.addEventListener("keyup",w),this.updateMovementVector(),this.updateRotationVector()}}function M(p){p.preventDefault()}function he(p){let n;return{c(){n=j("canvas"),this.h()},l(h){n=H(h,"CANVAS",{class:!0}),q(n).forEach(R),this.h()},h(){C(n,"class","svelte-1rxwyaw")},m(h,e){F(h,n,e),p[1](n)},p:L,i:L,o:L,d(h){h&&R(n),p[1](null)}}}let me=400,de=.7,le=0,pe=.8;function we(p,n,h){let e,o,s,a,i,m,b=performance.now(),u=0;new _("hsl(200, 50%, 50%)"),new E(0,0,0);let w,t;Q(()=>{r(),k()});function r(){a=new Y({antialias:!0,canvas:e}),a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),o=new X(45,window.innerWidth/window.innerHeight,.1,3e3),o.position.set(0,0,0),s=new B,s.background=new _(0);const l=new $().load("/sky/sky.jpg",function(){const g=new I(a);g.compileEquirectangularShader(),g.fromEquirectangular(l),l.dispose()}),y=new N;y.position.copy(o.position),y.rotation.copy(o.rotation),s.add(y),y.add(o),window.addEventListener("resize",P),new ie().load("../move/model.glb",function(g){m=g.scene,m.position.set(0,0,0),console.log(m);const v=.1;m.scale.set(v,v,v),s.add(m);const S=g.cameras[0];o.position.set(S.position.x*v,S.position.y*v,S.position.z*v),o.rotation.set(S.rotation.x,S.rotation.y,S.rotation.z),o.position.clone(),i=new ce(o,a.domElement),i.movementSpeed=me,i.rollSpeed=0,i.autoForward=!1,i.dragToLook=!0,i.lockPitch=!0,i.lockYaw=!0,i.lockRoll=!0,i.lockX=!0,i.lockY=!0,m.traverse(function(c){if(c.isMesh){const D=c.material;c.material=new Z({color:16777215,roughness:.5,metalic:1}),c.castShadow=!0,c.receiveShadow=!0,c.name=="light"&&(console.log(D),c.material=new J({color:16777215}),c.castShadow=!1,c.receiveShadow=!1,c.material.side=O)}})});const f=new ee(16777215,1);f.position.set(0,0,0),s.add(f),f.castShadow=!0,f.shadow.mapSize.width=2048,f.shadow.mapSize.height=2048,f.shadow.camera.near=.5,f.shadow.camera.far=2e3;const V=new te(0,16777215,.3);V.position.set(1,0,1),s.add(V),d()}function d(){w=new ne(a),w.addPass(new se(s,o)),t=new ae(new oe(window.innerWidth,window.innerHeight),de,le,pe),t.renderToScreen=!0,w.addPass(t)}function k(){const l=performance.now();requestAnimationFrame(k),u=(l-b)/1e3,b=l,i.update(u),o.position.z-=30*u,z()}function z(){a.render(s,o),w.render()}function P(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}function K(l){U[l?"unshift":"push"](()=>{e=l,h(0,e)})}return[e,K]}class ke extends A{constructor(n){super(),T(this,n,we,he,W,{})}}export{ke as default};
