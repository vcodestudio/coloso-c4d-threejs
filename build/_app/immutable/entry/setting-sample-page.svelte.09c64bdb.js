import{S as z,i as W,s as $,k as Y,l as q,m as O,h as P,n as j,b as X,I as D,o as Z,w as J}from"../chunks/index.2ecc7cbf.js";import{aw as K,ax as A,ay as U,az as S,aA as Q,w as V,W as ee,s as re,P as ae,S as ne,C as te,D as oe,av as ie,M as se,Z as le,d as ce}from"../chunks/three.module.a6fd982f.js";import{O as _e}from"../chunks/OrbitControls.4dddf048.js";class de extends K{constructor(c){super(c),this.type=A}parse(c){const d=function(e,n){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(n||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(n||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(n||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(n||""))}return-1},F=`
`,M=function(e,n,s){n=n||1024;let i=e.pos,t=-1,r=0,l="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(t=a.indexOf(F))&&r<n&&i<e.byteLength;)l+=a,r+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<t?(s!==!1&&(e.pos+=r+t+1),l+a.slice(0,t)):!1},B=function(e){const n=/^#\?(\S+)/,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,t=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,a;if(e.pos>=e.byteLength||!(l=M(e)))return d(1,"no header found");if(!(a=l.match(n)))return d(3,"bad initial token");for(r.valid|=1,r.programtype=a[1],r.string+=l+`
`;l=M(e),l!==!1;){if(r.string+=l+`
`,l.charAt(0)==="#"){r.comments+=l+`
`;continue}if((a=l.match(s))&&(r.gamma=parseFloat(a[1])),(a=l.match(o))&&(r.exposure=parseFloat(a[1])),(a=l.match(i))&&(r.valid|=2,r.format=a[1]),(a=l.match(t))&&(r.valid|=4,r.height=parseInt(a[1],10),r.width=parseInt(a[2],10)),r.valid&2&&r.valid&4)break}return r.valid&2?r.valid&4?r:d(3,"missing image size specifier"):d(3,"missing format specifier")},k=function(e,n,s){const o=n;if(o<8||o>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return d(3,"wrong scanline width");const i=new Uint8Array(4*n*s);if(!i.length)return d(4,"unable to allocate buffer space");let t=0,r=0;const l=4*o,a=new Uint8Array(4),y=new Uint8Array(l);let H=s;for(;H>0&&r<e.byteLength;){if(r+4>e.byteLength)return d(1);if(a[0]=e[r++],a[1]=e[r++],a[2]=e[r++],a[3]=e[r++],a[0]!=2||a[1]!=2||(a[2]<<8|a[3])!=o)return d(3,"bad rgbe scanline format");let L=0,E;for(;L<l&&r<e.byteLength;){E=e[r++];const R=E>128;if(R&&(E-=128),E===0||L+E>l)return d(3,"bad scanline data");if(R){const w=e[r++];for(let x=0;x<E;x++)y[L++]=w}else y.set(e.subarray(r,r+E),L),L+=E,r+=E}const C=o;for(let R=0;R<C;R++){let w=0;i[t]=y[R+w],w+=o,i[t+1]=y[R+w],w+=o,i[t+2]=y[R+w],w+=o,i[t+3]=y[R+w],t+=4}H--}return i},T=function(e,n,s,o){const i=e[n+3],t=Math.pow(2,i-128)/255;s[o+0]=e[n+0]*t,s[o+1]=e[n+1]*t,s[o+2]=e[n+2]*t,s[o+3]=1},v=function(e,n,s,o){const i=e[n+3],t=Math.pow(2,i-128)/255;s[o+0]=S.toHalfFloat(Math.min(e[n+0]*t,65504)),s[o+1]=S.toHalfFloat(Math.min(e[n+1]*t,65504)),s[o+2]=S.toHalfFloat(Math.min(e[n+2]*t,65504)),s[o+3]=S.toHalfFloat(1)},f=new Uint8Array(c);f.pos=0;const g=B(f);if(g!==-1){const e=g.width,n=g.height,s=k(f.subarray(f.pos),e,n);if(s!==-1){let o,i,t;switch(this.type){case U:t=s.length/4;const r=new Float32Array(t*4);for(let a=0;a<t;a++)T(s,a*4,r,a*4);o=r,i=U;break;case A:t=s.length/4;const l=new Uint16Array(t*4);for(let a=0;a<t;a++)v(s,a*4,l,a*4);o=l,i=A;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:n,data:o,header:g.string,gamma:g.gamma,exposure:g.exposure,type:i}}}return null}setDataType(c){return this.type=c,this}load(c,h,m,u){function p(_,d){switch(_.type){case U:case A:_.encoding=Q,_.minFilter=V,_.magFilter=V,_.generateMipmaps=!1,_.flipY=!0;break}h&&h(_,d)}return super.load(c,p,m,u)}}function he(b){let c;return{c(){c=Y("canvas"),this.h()},l(h){c=q(h,"CANVAS",{id:!0}),O(c).forEach(P),this.h()},h(){j(c,"id","canvas")},m(h,m){X(h,c,m),b[1](c)},p:D,i:D,o:D,d(h){h&&P(c),b[1](null)}}}function me(b,c,h){let m,u,p,_,d,G;Z(()=>{N(),I()});function N(){_=new ee({canvas:m,antialias:!0}),_.setPixelRatio(window.devicePixelRatio),_.setSize(window.innerWidth,window.innerHeight),_.outputEncoding=re,_.shadowMap.enabled=!0,u=new ae(45,window.innerWidth/window.innerHeight,1,2e3),u.position.set(0,0,200),d=new _e(u,_.domElement),d.target.set(0,10,0),d.update(),p=new ne,p.background=new te(0),new oe(16777215,1).position.set(0,1,1);const k=new ie(60,32,32),T=new se({color:16777215,roughness:.3,metalness:1,wireframe:!0});G=new le(k,T),G.position.set(0,10,0),G.castShadow=!0,p.add(G);const v="/sky/sky.hdr";new de().load(v,f=>{const g=new ce(_),e=g.fromEquirectangular(f).texture;p.environment=e,p.background=e,f.dispose(),g.dispose()})}function I(){requestAnimationFrame(I),F()}function F(){_.render(p,u)}function M(B){J[B?"unshift":"push"](()=>{m=B,h(0,m)})}return[m,M]}class Re extends z{constructor(c){super(),W(this,c,me,he,$,{})}}export{Re as default};
