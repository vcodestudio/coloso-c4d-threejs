import{S as U,i as F,s as Q,k as x,a as G,q as Y,l as M,m as P,h as g,c as X,r as $,n as z,b as V,E as B,I as R,o as I,w as N}from"../chunks/index.2ecc7cbf.js";import{E as Z,f as L,Q as K,C as D,W as J,P as O,S as ee,T as te,d as oe,G as ie,e as se,g as ae,h as ne,i as re,H as ce,V as he}from"../chunks/three.module.a6fd982f.js";import{G as me}from"../chunks/GLTFLoader.a254f7ff.js";import{E as de,R as le,U as pe}from"../chunks/UnrealBloomPass.f7db90c7.js";const we={type:"change"};class fe extends Z{constructor(n,m){super(),this.object=n,this.domElement=m,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const e=this,o=1e-6,t=new K,s=new L;this.tmpQuaternion=new K,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new L(0,0,0),this.rotationVector=new L(0,0,0),this.keydown=function(i){if(!i.altKey){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(i){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(i){if(this.dragToLook)this.status++;else{switch(i.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(i){if(!this.dragToLook||this.status>0){const r=this.getContainerDimensions(),d=r.size[0]/2,k=r.size[1]/2;this.moveState.yawLeft=-(i.pageX-r.offset[0]-d)/d,this.moveState.pitchDown=(i.pageY-r.offset[1]-k)/k,this.updateRotationVector()}},this.pointerup=function(i){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(i.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(i){const r=i*e.movementSpeed,d=i*e.rollSpeed;e.object.translateX(e.moveVector.x*r),e.object.translateY(e.moveVector.y*r),e.object.translateZ(e.moveVector.z*r),e.tmpQuaternion.set(e.rotationVector.x*d,e.rotationVector.y*d,e.rotationVector.z*d,1).normalize(),e.object.quaternion.multiply(e.tmpQuaternion),(s.distanceToSquared(e.object.position)>o||8*(1-t.dot(e.object.quaternion))>o)&&(e.dispatchEvent(we),t.copy(e.object.quaternion),s.copy(e.object.position))},this.updateMovementVector=function(){const i=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-i+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",W),this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointermove",a),this.domElement.removeEventListener("pointerup",b),window.removeEventListener("keydown",u),window.removeEventListener("keyup",w)};const a=this.pointermove.bind(this),h=this.pointerdown.bind(this),b=this.pointerup.bind(this),u=this.keydown.bind(this),w=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",W),this.domElement.addEventListener("pointerdown",h),this.domElement.addEventListener("pointermove",a),this.domElement.addEventListener("pointerup",b),window.addEventListener("keydown",u),window.addEventListener("keyup",w),this.updateMovementVector(),this.updateRotationVector()}}function W(p){p.preventDefault()}function ue(p){let n,m,e,o;return{c(){n=x("canvas"),m=G(),e=x("div"),o=Y('Press "W" or "S"'),this.h()},l(t){n=M(t,"CANVAS",{class:!0}),P(n).forEach(g),m=X(t),e=M(t,"DIV",{class:!0});var s=P(e);o=$(s,'Press "W" or "S"'),s.forEach(g),this.h()},h(){z(n,"class","svelte-6rhmoh"),z(e,"class","text svelte-6rhmoh")},m(t,s){V(t,n,s),p[1](n),V(t,m,s),V(t,e,s),B(e,o)},p:R,i:R,o:R,d(t){t&&g(n),p[1](null),t&&g(m),t&&g(e)}}}let ve=400,Se=.7,be=0,ke=.8;function ye(p,n,m){let e,o,t,s,a,h,b=performance.now(),u=0;new D("hsl(200, 50%, 50%)"),new L(0,0,0);let w,i;I(()=>{r(),k()});function r(){s=new J({antialias:!0,canvas:e}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),o=new O(45,window.innerWidth/window.innerHeight,.1,3e3),o.position.set(0,0,0),t=new ee,t.background=new D(0);const l=new te().load("/sky/sky.jpg",function(){const y=new oe(s);y.compileEquirectangularShader(),y.fromEquirectangular(l),l.dispose()}),E=new ie;E.position.copy(o.position),E.rotation.copy(o.rotation),t.add(E),E.add(o),window.addEventListener("resize",T);const q=new me,H=document.querySelector("input.baseUrl").value;q.load(`${H}move/model.glb`,function(y){h=y.scene,h.position.set(0,0,0),console.log(h);const v=.1;h.scale.set(v,v,v),t.add(h);const S=y.cameras[0];o.position.set(S.position.x*v,S.position.y*v,S.position.z*v),o.rotation.set(S.rotation.x,S.rotation.y,S.rotation.z),o.position.clone(),a=new fe(o,s.domElement),a.movementSpeed=ve,a.rollSpeed=0,a.autoForward=!1,a.dragToLook=!0,a.lockPitch=!0,a.lockYaw=!0,a.lockRoll=!0,a.lockX=!0,a.lockY=!0,h.traverse(function(c){if(c.isMesh){const C=c.material;c.material=new se({color:16777215,roughness:.5,metalic:1}),c.castShadow=!0,c.receiveShadow=!0,c.name=="light"&&(console.log(C),c.material=new ae({color:16777215}),c.castShadow=!1,c.receiveShadow=!1,c.material.side=ne)}})});const f=new re(16777215,1);f.position.set(0,0,0),t.add(f),f.castShadow=!0,f.shadow.mapSize.width=2048,f.shadow.mapSize.height=2048,f.shadow.camera.near=.5,f.shadow.camera.far=2e3;const _=new ce(0,16777215,.3);_.position.set(1,0,1),t.add(_),d()}function d(){w=new de(s),w.addPass(new le(t,o)),i=new pe(new he(window.innerWidth,window.innerHeight),Se,be,ke),i.renderToScreen=!0,w.addPass(i)}function k(){const l=performance.now();requestAnimationFrame(k),u=(l-b)/1e3,b=l,a.update(u),o.position.z-=30*u,A()}function A(){s.render(t,o),w.render()}function T(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function j(l){N[l?"unshift":"push"](()=>{e=l,m(0,e)})}return[e,j]}class Re extends U{constructor(n){super(),F(this,n,ye,ue,Q,{})}}export{Re as default};
